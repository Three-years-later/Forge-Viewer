# 设置Edit2D

Edit2D扩展提供了用于在Forge Viewer中显示和编辑2D图形的工具。这是四个教程的第一个，它们演示了Edit2D扩展的工作方式。本教程的末尾链接了有关使用Edit2D，自定义Edit2D以及使用JavaScript手动绘制Edit2D图形的其他教程。

在本教程中，您将学习：

* 如何加载Edit2D扩展
* 如何将您的应用程序与Edit2D连接

## Step 1: 载入扩展功能

要开始使用Edit2D，首先需要加载扩展。 在此示例中，我们将注册Edit2D的默认工具栏。您可以在Customize Edit2D教程中学习如何创建自己的工具栏以及其他[自定义](https://forge.autodesk.com/en/docs/viewer/v7/developers_guide/advanced_options/edit2d-customize/)项。

```js
// 加载Edit2D扩展
const options = {
  // 如果为true，则PolygonTool将创建路径，而不仅仅是多边形。这允许将线段更改为圆弧。
  enableArcs: true
};

const edit2d = await viewer.loadExtension('Autodesk.Edit2D');

// 在默认配置中注册所有标准工具
edit2d.registerDefaultTools();
```

## Step 2: 将您的应用程序与Edit2D连接

现在，您已经加载了扩展，您将需要确保Edit2D工具栏能够响应您的Forge Viewer应用程序。您可以通过设置Edit2D上下文并配置事件处理来实现。

<font color=gray size=4>2.1 设置Edit2D上下文</font>

注册默认工具将设置一个**Edit2DContext**，其中包含一个编辑层，工具以及该工具需要工作的所有内容。

```js
// 代码遵循上面的示例

const ctx = edit2d.defaultContext;

// {EditLayer}编辑包含您的图形的图层
ctx.layer

// {EditLayer} 工具用来显示临时图形的附加层（例如，用于捕捉的虚线等）
ctx.gizmoLayer

// {UndoStack} 管理所有修改并跟踪撤消/重做历史
ctx.undoStack

// {Selection} 控制选择和悬停突出显示
ctx.selection

// {Edit2DSnapper} Edit2D捕捉器
ctx.snapper
```

<font color=gray size=4>2.2 配置事件处理</font>

大多数Edit2D类都支持Forge Viewer EventListener接口。您可以通过几种不同的方式将应用程序UI和数据模型与Edit2D连接起来。在此步骤中，我们包括了两个示例：

* 同步数据模型
* 同步选择

<font color=black size=2>**同步数据模型**</font>

在您的应用程序中，图形可能具有Edit2D未知的特定于应用程序的含义。这意味着，当您使用Edit2D工具或撤消/重做修改图层时，特定于应用程序的数据模型将保持不变。为了使数据模型与对图层所做的更改保持同步，可以在**UndoStack**中注册事件侦听器。这样，无论修改是由工具，撤消还是重做引起的，都将使您得到一致的通知。将以下行之一添加到您的代码中，具体取决于您是希望在执行操作之前还是之后收到通知。

```js
// 作用前
ctx.undoStack.addEventListener(Autodesk.Edit2D.UndoStack.BEFORE_ACTION, beforeAction);

// 作用后
ctx.undoStack.addEventListener(Autodesk.Edit2D.UndoStack.BEFORE_ACTION, afterAction);
```

<font color=black size=2>**同步选择**</font>

您还可以使用**edit2d.context.selection**与UI中的某些项目的Edit2D同步选择。

一种方法是注册处理程序。处理程序确保如果选择更改，则通知应用程序。

在以下示例中，我们将处理程序设置为监听鼠标单击。

```js
// 注册您的处理程序
ctx.selection.addEventListener(Autodesk.Edit2D.SELECTION_CHANGED, onSelectionChanged);
```

同样，您可以将处理程序设置为同步鼠标悬停：

```js
// 悬停更改时更新UI状态
ctx.selection.addEventListener(Autodesk.Edit2D.SELECTION_HOVER_CHANGED, onHoverChanged);
```

默认情况下，选择和鼠标悬停突出显示由Edit2D工具自动控制。但是，您还可以通过直接访问ctx.selection来从应用程序中修改选择和悬停突出显示：

```js
// 从UI应用您的选择
ctx.selection.selectOnly(myItem.shape);

// 在UI悬停事件上同步Edit2D状态
ctx.selection.setHoverID(shape.id);
```

## Next

既然您已经设置了Edit2D，请查看以下教程：

* [使用Edit2D工具栏](https://forge.autodesk.com/en/docs/viewer/v7/developers_guide/advanced_options/edit2d-use/)
* [手动绘制Edit2D图形](https://forge.autodesk.com/en/docs/viewer/v7/developers_guide/advanced_options/edit2d-manual/)
* [自定义Edit2D](https://forge.autodesk.com/en/docs/viewer/v7/developers_guide/advanced_options/edit2d-customize/)
