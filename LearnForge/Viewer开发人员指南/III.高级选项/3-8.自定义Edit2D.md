# 自定义Edit2D

Edit2D定义了几个默认值以便立即可用。在“ 设置Edit2D教程”中，您研究了运行某些默认值的应用程序，包括Edit2D的默认工具栏和上下文。您可以通过多种方式自定义Edit2D行为。本教程将引导您完成其中的一些步骤。

在本教程中，您将能够：

* 定制单位
* 自定义您的工具栏
* 自定义上下文菜单
* 添加更多层
* 自定义选择和悬停的外观

在完成本教程之前，您应该熟悉如何在应用程序中设置和使用Edit2D。请参考设置Edit2D教程，以熟悉这些概念。本教程的末尾链接了有关Edit2D的其他教程，包括如何使用Edit2D以及如何使用JavaScript手动绘制Edit2D形状。

## Step 1: Customize Units(自定义单位)

默认情况下，Edit2D的单位处理与Forge Viewer中的**Measure**扩展配置相同。如果“**Measure**”扩展名不可用，则值将以1：1的形式显示在图层坐标中，而没有单位。

Edit2D使用**DefaultUnitHandler**设置标签文本的默认格式。默认单位处理程序定义如何将层中的度量转换为标签中显示的文本。这包括：-单位名称-层坐标中的长度和面积转换为显示值的方式-标签中显示的位数。

您可以通过替换默认的单位处理程序来定义自己的格式。 请注意，您需要在指定工具之前设置**unitHandler**。

```js
const unitHandler = new Autodesk.Edit2D.SimpleUnitHandler(viewer);
unitHandler.layerUnit    = 'in';
unitHandler.displayUnits = 'cm';
unitHandler.digits       = 4;

// 定义unitHandler后注册您的工具
```

## Step 2: 自定义工具栏

在上一教程中，我们使用registerDefaultTools()方法使用默认工具栏设置了Edit2D。此方法为您完成了一些步骤，以便快速设置Edit2D：

* 创建一个单层和小控件层
* 创建所有可用工具
* 在ToolController中注册工具

只要可以确保您是唯一在应用程序中使用Edit2D的人，那么使用默认工具集通常就足够了。但是，Edit2D也可以由同一应用程序中的不同软件组件使用。例如，如果在另一个Forge Viewer扩展中使用Edit2D，可能会发生这种情况。在这种情况下，如果不同的组件都访问相同的工具和EditLayer，则会产生冲突。

您可以通过注册自己的工具集来避免冲突。首先，您需要注册您的工具，为您的工具集指定一个唯一的名称给您的应用程序。

```js
edit2d.registerTools(MyToolSetName);
```

注册工具后，需要定义工具集，上下文和工具。

```js
const toolSet = edit2d.getToolSet(MyToolSetName);
const context = toolSet.context;
const tools   = toolSet.tools;
```

## Step 3: 自定义上下文菜单

加载Edit2D的默认工具集时，它会自动注册一个具有**addVertex**和**removeVertex**等功能的上下文菜单。您可以通过注册**contextMenuCallback**添加特定于应用程序的项目。更新Edit2D上下文菜单后，需要注册回调。这是因为当用户点击Edit2D形状时，Edit2D上下文菜单会替换Forge Viewer的默认上下文菜单。

```js
const myItem = {
  title: 'My extra menu item',
  target : ()=> {console.log('Hello new item);}
};

const cb = (menu) => {
  menu.push(item);
}

//构建contextMenu时，让Forge Viewer触发回调
viewer.registerContextMenuCallback('MyOwnItems', cb);
```

您也可以完全删除Edit2D contextMenu。

```js
const toolset = edit2d.getToolSet(MyToolSetName);
toolset.contextMenu.unregister();
```

## Step 4: 自定义选择和悬停的外观

默认情况下，当用户将鼠标悬停或选择时，显示的形状样式会略有不同。例如，当用户选择形状时，该形状将显示增加的线宽和填充不透明度。这些响应不会更改您正在编辑的形状的实际样式。而是，Edit2D使用样式修饰符。样式修饰符是一种回调，它临时用另一个形状替代图形的显示样式。

在以下示例中，我们将用自定义突出显示替换默认的样式修改行为，该行为将影响通过过滤器功能**(shapeId)=> bool**的所有形状。

```js
// 关闭默认突出显示行为
const selection = edit2d.defaultContext.selection;
layer.removeStyleModifier(selection.modifier);

// 定义自定义样式修改器
const myModifier = (shape, style) => {

  // 如果形状未通过过滤器，则样式不受影响
  if (!myFilter(shape.id)) {
      return undefined;
  }

  // 返回修改后的样式副本
  const modified = style.clone();
  modified.fillColor = 'rgb(255, 0, 0)';
  return modified;
};

layer.addStyleModifier(myModifier);
```

自定义突出显示可以但不必替换默认突出显示。图层支持按添加顺序应用的多个样式修饰符。

>注意：样式参数可以是原始多边形样式，也可以是先前应用的样式修改器返回的样式。确保创建修改后的副本，而不是更改样式本身。

## Step 5: 添加更多图层

当您注册工具时，Edit2D将为您的工具创建一个单独的**EditLayer**以便在**context.layer**上运行，并为临时叠加层创建一个EditLayer(**context.gizmoLayer**)。您可以将其他图层添加到默认设置。

```js
// 建立新图层
const anotherLayer = new Autodesk.Edit2d.EditLayer(viewer);
```

创建图层后，您可以选择显示方式。默认情况下，其他图层表示为叠加层。

```js
this.viewer.impl.addOverlay(OvelayName, layer.scene)
```

更一般而言，**layer.scene**是具有三角形形状的**Three.Scene**，您可以使用任何方式使用它。
