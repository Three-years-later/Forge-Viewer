# 使用Edit2D工具栏

现在，您已经将Edit2D与应用程序集成在一起，可以开始使用Edit2D工具创建图形了。

在本教程中，您将学习：

如何使用各种Edit2D工具
如何显示和更改标签
如何使用捕捉
本教程中有一些代码示例，但是大部分内容演示了将Edit2D加载到Forge Viewer应用程序后如何为最终用户工作。您将需要Google Chrome浏览器才能完成本教程。

这是有关Edit2D的四个教程之一。到目前为止，您应该已经完成​​了Set Edit2D教程。其余的教程（它们教您如何自定义Edit2D和使用JavaScript手动绘制Edit2D图形）在本教程的末尾链接。

## Step 1: 运行Edit2D Playground

对于本教程，您需要设置Edit2D Playground。 Edit2D Playground对于调试Edit2D和测试其功能很有用。要设置Playground，请将以下代码段复制到您的Chrome DevTools代码段集合中并运行它：

```js
// 方便访问扩展和层
window.edit2d = NOP_VIEWER.getExtension('Autodesk.Edit2D');
window.layer  = edit2d.defaultContext.layer;
window.tools  = edit2d.defaultTools;

// 方便的功能，用于每个控制台的工具切换。例如,startTool（tools.polygonTool）
var startTool = function(tool) {

  var controller = NOP_VIEWER.toolController;

  // 检查当前活动的工具是否来自Edit2D
  var activeTool = controller.getActiveTool();
  var isEdit2D = activeTool && activeTool.getName().startsWith("Edit2");

  // 停用任何先前的edit2d工具
  if (isEdit2D) {
      controller.deactivateTool(activeTool.getName());
      activeTool = null;
  }

  // 停止编辑工具
  if (!tool) {
      return;
  }

  controller.activateTool(tool.getName());
}
```

设置Edit2D Playground可使您快速访问某些Edit2D功能。请注意，由于这些功能是用于测试的机制，因此不应将其用于生产代码或环境。我们在本教程中使用它们来向您展示Edit2D扩展程序在加载到您的应用程序后如何工作。

## Step 2: 使用Edit2D工具绘制图形

此步骤演示如何使用四个Edit2D工具：

* PolygonTool 多边形工具
* PolylineTool 折线工具
* PolygonEditTool 多边形编辑工具
* InsertSymbolTool 插入符号工具

当您调用registerDefaultTools()时，这些工具将可用，在加载扩展时我们在教程“设置Edit2D”中进行了操作。我们会将这些工具加载到控制台中，以演示每个工具的工作原理。

<font color=gray size=4>2.1 PolygonTool：绘制多边形和矩形</font>

要开始使用PolygonTool，请在控制台中键入以下内容：

```js
startTool(tools.PolygonTool);
```

鼠标光标将变为十字形。

![示例图06](https://developer.doc.autodesk.com/bPlouYTd/264/_images/PolygonTool.jpg)

激活**PolygonTool**后，您可以：

1. 单击以开始一个新的多边形。
2. 再次单击以将顶点添加到多边形。
3. Backspace(退格键)可删除最近添加的顶点。
4. ESC放弃新的多边形。
5. 按住Shift可禁用捕捉。默认情况下，快照功能处于活动状态。
6. 双击以添加多边形的最终顶点。完成多边形的键盘快捷键是Enter和c键。

使用PolygonTool，您还可以单击并拖动以绘制矩形：

1. 按住鼠标选择矩形的起点。
2. (可选)按住Shift键可将矩形强制为正方形。
3. 拖动鼠标确定矩形的长度和宽度。
4. 释放鼠标以完成矩形。

![示例图07](https://developer.doc.autodesk.com/bPlouYTd/264/_images/RectangleTool.jpg)

<font color=gray size=4>2.2 PolylineTool：绘制折线</font>

要绘制折线，请启动``PolylineTool：

```js
startTool(tools.polylineTool)
```

**PolylineTool**的工作方式与**PolygonTool**相似，允许您逐点单击以绘制折线。您可以使用一次拖动交互来绘制简单的线条。

![示例图08](https://developer.doc.autodesk.com/bPlouYTd/264/_images/PolylineTool.jpg)

<font color=gray size=4>2.3 PolygonEditTool：修改多边形和路径</font>

要编辑多边形，请启动PolygonEditTool。

```js
startTool(tools.polygonEditTool);
```

现在，图层中的图形应在鼠标悬停时具有较高的填充不透明度。现在，您可以单击要编辑的图形。

使用**PolygonEditTool**，您可以执行以下操作：

* 通过拖动来**移动图形(Move a shape)**。
* 通过拖动顶点小控件来**移动顶点(Move vertices)**。

![示例图09](https://developer.doc.autodesk.com/bPlouYTd/264/_images/MoveVertex.jpg)

* 按住**Shift**键可**禁用捕捉(disable snapping)**。默认情况下，快照功能处于活动状态。
* 通过拖动边缘小控件来**移动边缘(Move edges)**。 移动边缘时，相邻边缘将变大或变小。

![示例图10](https://developer.doc.autodesk.com/bPlouYTd/264/_images/MoveEdge.jpg)

* 通过拖动边缘来**创建凸起(Create Protrusions)**。如果移动的边缘与其相邻的边缘在同一条线上，则系统会添加一个额外的角。此功能可用于快速编辑具有直角图形的突起。

![示例图11](https://developer.doc.autodesk.com/bPlouYTd/264/_images/MoveEdgeSpecial.jpg)

* 使用**Esc**键**取消拖动交互(Cancel dragging interaction)**。
* 右键单击边缘以**插入新顶点(Insert new vertex)**。这将拉出上下文菜单。

![示例图12](https://developer.doc.autodesk.com/bPlouYTd/264/_images/ContextMenuAddVertex.jpg)

* 通过单击顶点Gizmo并按**Backspace删除顶点(Remove vertices)**。 您也可以右键单击顶点Gizmo以拉出上下文菜单。
* 使用**Ctrl-C/Ctrl-V**复制/粘贴图形。粘贴多次将创建多个重复项。

![示例图13](https://developer.doc.autodesk.com/bPlouYTd/264/_images/CopyPaste.jpg)

* 通过右键单击一条边并在上下文菜单中选择“**更改为弧段(Change to Arc Segment)**”，将**线更改为贝塞尔曲线(Change lines to Bezier arcs)**。 作为快捷方式，您可以选择边缘并按**a**。
* 使用弧段的上下文菜单将弧**变回直线(Change arcs back to lines)**。 作为快捷方式，您可以选择边缘并按**l**。

![示例图14](https://developer.doc.autodesk.com/bPlouYTd/264/_images/ChangeToLine.jpg)

* 通过拖动选定弧边的切线小控件来**编辑曲线线段(Edit tangents of curve segments)**的切线。

![示例图15](https://developer.doc.autodesk.com/bPlouYTd/264/_images/TangentGizmos.jpg)

* 使用上下文菜单**将线段更改为椭圆弧(Change segments into ellipse arcs)**。

![示例图16](https://developer.doc.autodesk.com/bPlouYTd/264/_images/ContextMenuEllipseArc.jpg)

* 通过选择一条边并在弧的中心拖动紫色Gizmo来**编辑椭圆弧(Edit ellipse arcs)**。

![示例图17](https://developer.doc.autodesk.com/bPlouYTd/264/_images/EditEllipseArc.jpg)

<font color=gray size=4>2.4 InsertSymbolTool</font>

使用InsertSymbolTool，可以单击以在鼠标位置插入图形实例。

```js
startTool(tools.insertSymbolTool);
```

默认图形是圆形。您可以通过更改工具的symbol属性来替换默认值。在以下示例中，我们将更改**InsertSymbolTool**，以使其创建以鼠标位置为中心的长度为1的水平线：

```js
let line = new Autodesk.Edit2D.Polyline().makeLine(-1, -1, 1, 1);
tools.insertSymbolTool.symbol=line;
```

## Step 3: Display Labels(显示标签)

设置好一些基本图形后，让我们通过创建标签为图形添加含义。标签可以指定图形的长度和面积，也可以说出所需的内容。

<font color=gray size=4>3.1 面积和长度标签</font>

**PolygonTool**和**PolygonEditTool**都有显示区域（多边形）和各自长度（折线）的选项。

要显示正在编辑的多边形的区域，请调用以下命令：

```js
tools.polygonTool.setAreaLabelVisible(true);
```

![示例图18](https://developer.doc.autodesk.com/bPlouYTd/264/_images/PolygonToolLabel.jpg)

同样，您可以显示新折线的长度：

```js
tools.polygonTool.setLengthLabelVisible(true);
```

![示例图19](https://developer.doc.autodesk.com/bPlouYTd/264/_images/PolylineToolLabel.jpg)

您可以在PolygonEditTools中使用相同的功能来显示图形的面积和长度。

```js
tools.polygonEditTool.setAreaLabelVisible(true);
tools.polygonEditTool.setLengthLabelVisible(true);
```

<font color=gray size=4>3.2 面积和长度单位</font>

Edit 2D使用与MeasureExtension相同的单位和长度校准。您可以使用MeasureExtension的校准面板为Edit2D图形指定单位和校准。

![示例图20](https://developer.doc.autodesk.com/bPlouYTd/264/_images/UnitsCalibration.jpg)

如果使用不带MeasureExtension的Edit2D，它将以模型单位显示所有坐标。您可以通过修改或替换**DefaultUnitHandler**来自定义单位。更多信息可在Customize Edit2D教程中获得。

<font color=gray size=4>3.3 创建自定义标签</font>

您也可以给图形自定义文本标签。以下示例将自定义文本标签附加到图层中的第一个图形。

```js
var poly = layer.shapes[0];
var label = new Autodesk.Edit2D.ShapeLabel(poly, layer);
label.setText('MyLabel');
```

同样，您可以将自定义标签粘贴到图形的边缘。

```js
var poly = layer.shapes[0];
var label = new Autodesk.Edit2D.EdgeLabel(layer);
label.attachToEdge(poly, 0);
label.setText('My Edge Label');
```

如果您不再需要标签，则可以将其删除。

```js
label.dtor();
```

<font color=gray size=4>3.4 将标签应用于多个图形</font>

您可以使用**ShapeLabelRule**轻松将标签应用于整个图形。**ShapeLabelRule**将定义如何应用标签的规则。

**ShapeLabelRule**具有一些默认设置。您可以配置或替换任何这些设置。

* 标签在添加图形时创建，在删除图形时删除。
* 仅针对大于5像素的可见图形创建标签。
* 当图形小于5像素时，标签会平滑淡出。

使用**ShapeLabelRule**，您还可以定义：

* *Filter(过滤器 )*：确定应标记哪些图形。
* *Text rule(文本规则 )*：确定每个图形的文本。
* *Style rule(样式规则 )*：(可选)确定如何样式化标签。

一个简单的示例是创建一个显示图形属性的**ShapeLabelRule**。在此示例中，我们将使用其类别名称标记每个图形。

```js
// 用其className标记每个图形
var classRule = new Autodesk.Edit2D.ShapeLabelRule(layer, shape => shape.constructor.name);
```

![示例图21](https://developer.doc.autodesk.com/bPlouYTd/264/_images/ShapeLabelRule.jpg)

## Step 4: Snapping(捕捉)

绘制新图形或移动顶点时，**PolygonTool**和**PolylgonEditTool**支持许多类型的捕捉。

* 捕捉到图纸几何
* 捕捉以编辑图层几何
* 捕捉角度
* 捕捉到上述类型的组合。

默认情况下，快照是活动的，但可以通过按住**Shift**来抑制。几何捕捉和捕捉指示符在Edit2D中的工作方式与Measure扩展相同。当前仅由Edit2D支持捕捉到相交和角度。

<font color=gray size=4>4.1 几何捕捉</font>

有两种类型的几何捕捉。

* **Point-Snap(点捕捉)**：捕捉到唯一点。这可以是线顶点，圆中点或线相交。Edit2D显示一个正方形，指示您正在创建点捕捉。
![示例图22](https://developer.doc.autodesk.com/bPlouYTd/264/_images/SnapToVertex.jpg)

* **Segment-Snap(分段捕捉)**：对齐分段(例如直线或圆弧)。该位置未完全对齐，但被限制在某个段中。Edit2D显示了三行的十字准线，表明您正在创建段快照。
![示例图23](https://developer.doc.autodesk.com/bPlouYTd/264/_images/SnapToLine.jpg)

<font color=gray size=4>4.2 角度捕捉</font>

当使用**PolygonTool**或通过**PolygonEditTool**移动顶点时，角度捕捉由红色虚线表示。
![示例图24](https://developer.doc.autodesk.com/bPlouYTd/264/_images/AngleSnapping.jpg)

默认情况下，我们捕捉到45°倍数的角度。您可以通过更改**AngleSnapper**中的捕捉角度表来更改此行为。

```js
edit2d.defaultContext.snapper.angleSnapper.snapAngles
```

角度捕捉总是指您当前正在修改的“新”边缘。

* 在**PolygonTool**中，这是指在当前鼠标位置添加下一个顶点时将获得的新边。
* 在**PolyEditTool**中，移动顶点时，它指的是在要移动的顶点处开始/结束的边。

如果新边缘与图形中的任何其他边缘形成捕捉角，则角度捕捉将起作用。您也可以捕捉到另一条边的垂直平分线。
![示例图25](https://developer.doc.autodesk.com/bPlouYTd/264/_images/SnapToBisector.jpg)

<font color=gray size=4>4.3 交叉捕捉</font>

捕捉到某个角度或线段只会将捕捉位置限制到一个线段。如果鼠标位置可以捕捉到多条线，则选择最接近的两个点的交点。

以下情况是可能的：

* 两个几何段之间的相交（每个可以是图纸几何或编辑图层几何）
* 两个角度捕捉线之间的相交
* 角捕捉线和线段之间的交点。

下图显示了第三种情况的示例。垂直平分线(角度捕捉)和图纸上的线段(几何捕捉)的交点。
![示例图26](https://developer.doc.autodesk.com/bPlouYTd/264/_images/SnapToIntersect.jpg)
