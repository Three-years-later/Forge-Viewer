# 加载模型

加载模型是一个两步过程。

1. 从Model Derivative API获取清单JSON 。
2. 指示查看器加载清单JSON引用的模型之一。

## 开始之前

加载模型之前，必须使用Model Derivative API 的POST作业终结点来启动转换作业，该转换作业会将模型转换为SVF格式。转换作业会生成一个称为清单的JSON文件。清单提供了翻译作业所产生的资源的详细信息（例如，模型几何，缩略图，摄像机视图）。

有关更多信息，请参见Model Derivative API文档中的“[为查看器准备文件](https://forge.autodesk.com/en/docs/model-derivative/v2/tutorials/prep-file4viewer/)”教程。

为了使用Model Derivative API，您必须有一个**ACCESS_TOKEN**。使用Forge[身份验证](https://forge.autodesk.com/en/docs/oauth/v2/reference/http/)API获取访问令牌。Viewer支持2-legged和3-legged标记。

## Step 1: 提取清单

清单是包含转换工作结果的JSON文档。随着此过程的进行，JSON文档中的内容将更新以反映翻译作业的进度。转换过程完成后，JSON文档将包含对所有可用派生工具的引用，其中一些是可以加载到Viewer中的模型。

Viewer库提供了一种静态方法，用于获取指定的URN字符串值的清单。

```js
var documentId = 'urn:dXJuOmFkc2sub2JqZWN0czpvcy5vYmplY3Q6bXktYnVja2V0L215LWF3ZXNvbWUtZm9yZ2UtZmlsZS5ydnQ';
Autodesk.Viewing.Document.load(documentId, onDocumentLoadSuccess, onDocumentLoadFailure);

function onDocumentLoadSuccess(viewerDocument) {
  // viewerDocument is an instance of Autodesk.Viewing.Document
}

function onDocumentLoadFailure() {
  console.error('Failed fetching Forge manifest');
}
```

Notes:

* documentId是已翻译模型的URN的字符串值。
* 必须将URN编码为未填充的Base64字符串。有关Base64编码的更多信息，请参见Model Derivative API文档中的“为查看器准备文件”教程。
* 分配给documentId的值必须以字符串urn开头：
* 如果要重复使用上面显示的代码段，请使用您自己的翻译作业中的URN替换documentId的值。
* 在某些情况下，您可能需要确定URN是来自EMEA还是US。 从对URN进行base64解码开始，然后检查它是否包含urn：adsk.wipemea：xxx（对于EMEA）或urn：adsk.wipprod：xxx（对于US）。 有关更多信息，请参见有关“欧洲数据中心支持” _的博客。

成功获取清单后，将调用回调onDocumentLoadSuccess。 回调接收自变量viewerDocument，它是[Autodesk.Viewing.Document](https://forge.autodesk.com/en/docs/viewer/v7/reference/Viewing/Document/)的实例。

## Step 2: 在清单中加载模型

以下代码段假定viewer实例可用。请参阅“ 初始化查看器”页面以了解如何完成。

您可以选择加载默认模型，或从清单中所有模型的列表中进行选择。

要在清单中加载默认模型：

```js
var defaultModel = viewerDocument.getRoot().getDefaultGeometry();
viewer.loadDocumentNode(viewerDocument, defaultModel);
```

要选择其他模型，请检索所有模型的列表，并使用自定义代码来决定加载哪个模型：

```js
var viewables = viewerDocument.getRoot().search({'type':'geometry'});
viewer.loadDocumentNode(viewerDocument, viewables[0]);

```

## 放在一起

在这一点上，开发人员应该具有如下代码：

```js
var documentId = 'urn:dXJuOmFkc2sub2JqZWN0czpvcy5vYmplY3Q6bXktYnVja2V0L215LWF3ZXNvbWUtZm9yZ2UtZmlsZS5ydnQ';
Autodesk.Viewing.Document.load(documentId, onDocumentLoadSuccess, onDocumentLoadFailure);

function onDocumentLoadSuccess(viewerDocument) {
  var defaultModel = viewerDocument.getRoot().getDefaultGeometry();
  viewer.loadDocumentNode(viewerDocument, defaultModel);
}

function onDocumentLoadFailure() {
  console.error('Failed fetching Forge manifest');
}
```
