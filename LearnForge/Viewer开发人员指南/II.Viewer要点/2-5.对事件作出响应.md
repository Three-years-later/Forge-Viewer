# 对事件作出响应

事件是一种机制，用于通知第三方代码有关Viewer中的更改。 查看器实际上侦听其自己的事件以更新UI状态。 有关可用事件的列表，请参见API参考的“[查看命名空间](https://forge.autodesk.com/en/docs/viewer/v7/reference/Viewing/#escape-event)”主题。

本主题演示如何为Autodesk.Viewing.SELECTION_CHANGED_EVENT和Autodesk.Viewing.NAVIGATION_MODE_CHANGED_EVENT添加侦听器。 我们将更改HTML内容以显示当前选择了多少元素以及当前设置了什么导航工具。

![示例图03](https://developer.doc.autodesk.com/bPlouYTd/264/_images/events_tutorial5.png)

## 开始之前

我们建议将本示例中的代码封装在[extension](https://forge.autodesk.com/en/docs/viewer/v7/developers_guide/viewer_basics/extensions/)中。

## Step 1: 将选择计数器添加到HTML

首先，添加一个HTML元素，该元素显示当前选中的节点数。 在查看器的div之后添加HTML块。

```html
<div class="my-custom-ui">
  <div>Items selected: <span id="MySelectionValue">0</span></div>
<div>
```

添加以下样式。

```css
<style>
  .my-custom-ui {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 5;
      margin: .3em;
      padding: .3em;
      font-size: 3em;
      font-family: sans-serif;
      background-color: rgba(255, 255, 255, 0.85);
      border-radius: 8px;
  }
  .my-custom-ui span {
      color: red;
  }
</style>
```

每当触发Autodesk.Viewing.SELECTION_CHANGED_EVENT时，＃MySelectionValue的内容都会更改。

## Step 2: 监听并响应事件

事件是通过Viewer3D实例调度的。 现在，我们添加一个函数来处理选择更改事件。 我们还将在扩展程序的**load()**函数上调用**addEventListener()**，并在扩展程序的**unload()**函数上调用**removeEventListener()**。

```js
// Event hanlder for Autodesk.Viewing.SELECTION_CHANGED_EVENT
EventsTutorial.prototype.onSelectionEvent = function(event) {
  var currSelection = this.viewer.getSelection();
  var domElem = document.getElementById('MySelectionValue');
  domElem.innerText = currSelection.length;
};

EventsTutorial.prototype.load = function() {
  this.onSelectionBinded = this.onSelectionEvent.bind(this);
  this.viewer.addEventListener(Autodesk.Viewing.SELECTION_CHANGED_EVENT, this.onSelectionBinded);
  return true;
};

EventsTutorial.prototype.unload = function() {
  this.viewer.removeEventListener(Autodesk.Viewing.SELECTION_CHANGED_EVENT, this.onSelectionBinded);
  this.onSelectionBinded = null;
  return true;
};
```

我们使用**bind()**在**onSelectionEvent()**中保留对**this**的引用。

此时，每次选择节点时，计数器将更改为该数字。 通过使用键盘上的**ESC**删除选择。 您可以通过使用**Shift-Click**或**Ctrl-Click**选择其他节点。 请注意，您还可以使用这些命令切换选择。

## Step 3: 另一个事件

查看器的工具栏具有可更改当前导航工具的按钮。工具负责将用户输入转换为操作。导航工具尤其涉及在场景中导航摄像机。

![示例图04](https://developer.doc.autodesk.com/bPlouYTd/264/_images/toolbar_navigation5.png)

现在，我们来监听Autodesk.Viewing.NAVIGATION_MODE_CHANGED_EVENT并在屏幕上显示该工具的名称。 首先按如下所示修改最初添加的HTML。

```html
<div class="my-custom-ui">
  <div>Items selected: <span id="MySelectionValue">0</span></div>
  <div>Navigation tool: <span id="MyToolValue">Unknown</span></div>
<div>
```

我们还需要添加事件处理程序并修改**load()**和**unload()**方法。

```js
// New event for handling Autodesk.Viewing.NAVIGATION_MODE_CHANGED_EVENT
// Follows a similar pattern
EventsTutorial.prototype.onNavigationModeEvent = function(event) {
  var domElem = document.getElementById('MyToolValue');
  domElem.innerText = event.id;
};

EventsTutorial.prototype.load = function() {
  this.onSelectionBinded = this.onSelectionEvent.bind(this);
  this.onNavigationModeBinded = this.onNavigationModeEvent.bind(this);
  this.viewer.addEventListener(Autodesk.Viewing.SELECTION_CHANGED_EVENT, this.onSelectionBinded);
  this.viewer.addEventListener(Autodesk.Viewing.NAVIGATION_MODE_CHANGED_EVENT, this.onNavigationModeBinded);
  return true;
};

EventsTutorial.prototype.unload = function() {
  this.viewer.removeEventListener(Autodesk.Viewing.SELECTION_CHANGED_EVENT, this.onSelectionBinded);
  this.viewer.removeEventListener(Autodesk.Viewing.NAVIGATION_MODE_CHANGED_EVENT, this.onNavigationModeBinded);
  this.onSelectionBinded = null;
  this.onNavigationModeBinded = null;
  return true;
};
```

注意，对于这个新事件，我们实际上正在使用**id**属性并将其分配为**innerText**。 调度的大多数事件都具有与之关联的数据。 也可以从**Viewer**实例中提取相同的数据。 可以通过调用**this.viewer.getActiveNavigationTool()**从查看器获取相同的**id**值。

```js
// Alternative handler for Autodesk.Viewing.NAVIGATION_MODE_CHANGED_EVENT
EventsTutorial.prototype.onNavigationModeEvent = function(event) {
  var domElem = document.getElementById('MyToolValue');
  domElem.innerText = this.viewer.getActiveNavigationTool(); // same value as event.id
};
```

现在事件已挂载，请尝试单击查看器工具栏中的导航按钮。 您会发现事件处理程序将接管工具更换事件！
